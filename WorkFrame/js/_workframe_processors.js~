var _wf_custom_field_error_class = 'has-error';
var _wf_custom_field_success_class = 'has-success';
var _wf_custom_field_warning_class = 'has-warning';

function _wf_field_id(form_id, field_name) {
    return form_id + '__' + field_name;
}

function _wf_get_results_by_field(results) {
        var field_results = [];
        for(i in results) {
                field_results[results[i]['field_name']] = results[i];
        }
        return field_results;
}

function _wf_set_fields_group_state(form_id,field_name, state) {

	var $field_group = $("#"+field_id).closest('.wf_field_group');
	$field_group.removeClass('wf_error_field wf_success_field wf_warning_field '+_wf_custom_field_error_class + ' '+_wf_custom_field_success_class + ' '+_wf_custom_field_warning_class);

	$field_group.addClass(window['_wf_custom_field_'+state+'_class'] + ' wf_'+state+'_field');
}

//TODO: Populate the main error list UL at top of form ?
function _wf_show_errors(form_id, errors){
        var errors = _wf_get_results_by_field(errors); // Actually - now this is only ever called for individual fields! so this is pointless. TODO: remove it

//	$("#"+form_id+"__wf_errors").html('').show();
	$("#"+form_id+" .wf_field_error_container").html('').hide();

	for(field_name in field_errors) {
		var html = '<ul class="wf_field_errors_inline">';
		for(i in field_errors[field_name]) {
			error = field_errors[field_name][i];

			html += '<li>' + h(error['error_message']);
			if("error_details" in error) {
				html += " <span class'wf_error_details'>"+(h(error['error_details']))+"</span>";
			}
			html += '</li>';
		}
        	html += '</ul>';
		var field_id = _wf_field_id(form_id, field_name);
        	$("#"+field_id+"__wf_field_error_container").html(field_error_html).show();
		_wf_set_fields_group_state(field_id, 'error')
	}
}

// TODO This is a clone of the above pretty much, perhaps refactor + merge
function _wf_show_warnings(form_id, warnings){
        var warnings = _wf_get_results_by_field(warnings); // Actually - now this is only ever called for individual fields! so this is pointless. TODO: remove it

	$("#"+form_id+" .wf_field_warning_container").html('').hide();

	for(field_name in field_warnings) {
		var html = '<ul class="wf_field_warnings_inline">';
		for(i in field_warnings[field_name]) {
			warning = field_warnings[field_name][i];

			html += '<li>' + h(warning['warning_message']);
			if("warning_details" in warning) {
				html += " <span class'wf_warning_details'>"+(h(warning['warning_details']))+"</span>";
			}
			html += '</li>';
		}
		html += '</ul>';
		var field_id = _wf_field_id(form_id, field_name);
		_wf_set_fields_group_state(field_id, 'warning');
            	$("#"+field_id+"__wf_field_warnings_container").html(field_warning_html).show();
	}
}

function _wf_show_successes(form_id, success_field_ids){
	for(i in success_field_ids) {
		_wf_set_fields_group_state(field_id, 'succeses');
	}
}

function _wf_validate_email(email) {
    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(email);
}
function _wf_validate_password(pw) {
    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(pw);
}
